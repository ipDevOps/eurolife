@using Wedia.Feature.Media
@using Wedia.Feature.Media.Repositories
@using Wedia.Foundation.Alerts
@using Wedia.Foundation.Alerts.Extensions
@using Wedia.Foundation.Dictionary.Extensions
@using Wedia.Foundation.SitecoreExtensions.Extensions
@model Sitecore.Mvc.Presentation.RenderingModel
@if (!Model?.Item?.DescendsFrom(Templates.HasMediaSelector.ID) ?? true)
{
  @Html.PageEditorError(AlertTexts.InvalidDataSourceTemplate(Templates.HasMediaSelector.ID), AlertTexts.InvalidDataSourceTemplateFriendlyMessage, Model.Item?.ID, Model.Rendering.Item?.ID)
  return;
}

@{
  var carouselId = "carousel" + Guid.NewGuid().ToString("N");
  var elements = MediaRepository.Get(Model.Item).ToArray();
  int? carouselHeight = null;
}

  <section class="hero hero--extra m-b-112 relator">
    <div class="js-hero-slider hero-slider">
      @foreach (var element in elements)
      {
        var field = element.Item.Fields[Templates.HasMediaImage.Fields.Image].ID;
        var image = element.Item.ImageUrl(field);
        var description = element.Item.Fields[Templates.HasMedia.Fields.Description];
        var title = element.Item.Fields[Templates.HasMedia.Fields.Title];
        var label = element.Item.Fields[Templates.HasMedia.Fields.Label];
        var url = "#";

        if (element.Item.DescendsFrom(Templates.HasMediaUrl.ID) && element.Item.FieldHasValue(Templates.HasMediaUrl.Fields.Url))
        {
          url = element.Item.LinkFieldUrl(Templates.HasMediaUrl.Fields.Url);
        }

        if (element.Item.DescendsFrom(Templates.HasMediaVideo.ID))
        {
          var videoUrl = element.Item.LinkFieldUrl(Templates.HasMediaVideo.Fields.VideoLink);
          var linkDescription = Model.Item.LinkFieldOptions(Templates.HasMediaVideo.Fields.VideoLink, Wedia.Foundation.SitecoreExtensions.Extensions.LinkFieldOption.Text);
          var target = Model.Item.LinkFieldOptions(Templates.HasMediaVideo.Fields.VideoLink, Wedia.Foundation.SitecoreExtensions.Extensions.LinkFieldOption.Target);

          <a class="hero-slider__item" data-fancybox="hero-video" href="@videoUrl">
            <div class="hero-contents">
              <div class="center--760 center relator">
                <div class="icon">
                  @Html.Sitecore().Field(Templates.HasMedia.Fields.Thumbnail, element.Item, new { DisableWebEdit = true })
                </div>

                <h3 class="h5">@label</h3>
                <h2 class="h2 m-b-16 m-t-32">@title</h2>

                <p>@description</p>
              </div>
            </div>
            <picture>
              <source media="(min-width: 900px)" srcset="@image" />
              <source srcset="@image" />
              <img src="@image" alt="@title" />
            </picture>
          </a>
        }
        else
        {

          var target = Model.Item.LinkFieldOptions(Templates.HasMediaUrl.Fields.Url, Wedia.Foundation.SitecoreExtensions.Extensions.LinkFieldOption.Target);
          var linkDescription = Model.Item.LinkFieldOptions(Templates.HasMediaUrl.Fields.Url, Wedia.Foundation.SitecoreExtensions.Extensions.LinkFieldOption.Text);

          if(string.IsNullOrEmpty(linkDescription))
          {
            linkDescription = @Html.Sitecore().Dictionary("/Media/Carousel/CTA", "CTA TEXT");
          }

          <a class="hero-slider__item" href="@url" target="@target">
            <div class="hero-contents">
              <div class="center--760 center relator">
                <h3 class="h6">@label</h3>
                <h2 class="h2 m-b-16 m-t-16">@title</h2>
                <p>@description</p>
                <span class="btn--dark btn btn--default m-t-24" href="@url">@linkDescription</span>
              </div>
            </div>
            <picture>
              <source media="(min-width: 900px)" srcset="@image" />
              <source srcset="@image" />
              <img src="@image" alt="@title" />
            </picture>
          </a>
        }

      }

    </div>

    <div class="wprev">
      <?xml version="1.0" ?>
      <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'>
      <svg enable-background="new 0 0 32 32" height="32px" id="Слой_1" version="1.1" viewBox="0 0 32 32" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path clip-rule="evenodd" d="M11.262,16.714l9.002,8.999  c0.395,0.394,1.035,0.394,1.431,0c0.395-0.394,0.395-1.034,0-1.428L13.407,16l8.287-8.285c0.395-0.394,0.395-1.034,0-1.429  c-0.395-0.394-1.036-0.394-1.431,0l-9.002,8.999C10.872,15.675,10.872,16.325,11.262,16.714z" fill="#121313" fill-rule="evenodd" id="Chevron_Right" /><g /><g /><g /><g /><g /><g /></svg>
    </div>
    <div class="wnext">
      <?xml version="1.0" ?>
      <!DOCTYPE svg PUBLIC '-//W3C//DTD SVG 1.1//EN' 'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'>
      <svg enable-background="new 0 0 32 32" height="32px" id="Слой_1" version="1.1" viewBox="0 0 32 32" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path clip-rule="evenodd" d="M21.698,15.286l-9.002-8.999  c-0.395-0.394-1.035-0.394-1.431,0c-0.395,0.394-0.395,1.034,0,1.428L19.553,16l-8.287,8.285c-0.395,0.394-0.395,1.034,0,1.429  c0.395,0.394,1.036,0.394,1.431,0l9.002-8.999C22.088,16.325,22.088,15.675,21.698,15.286z" fill="#121313" fill-rule="evenodd" id="Chevron_Right" /><g /><g /><g /><g /><g /><g /></svg>
    </div>

    <div class="grouping-dots"></div>
    <div class="hidden custom-dots js-custom-dots">
      @foreach (var element in elements)
      {
        <span class="dot"></span>
      }
    </div>
  </section>